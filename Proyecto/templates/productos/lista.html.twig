{% extends 'base.html.twig' %}

{% block title %}
    <link rel="stylesheet" href="{{ asset('css/carousel.css') }}">
{% endblock %}

{% block body %}
<div class="container">
    <div class="row">
        <!-- Filtro lateral -->
        <div class="col-md-3">
            <form method="get" action="{{ path('app_productos') }}">
                <div class="filter-sidebar card p-3">
                    <h5 class="card-title">Filtros</h5>

                    <!-- Filtro de Ofertas -->
                    <div class="form-check">
                        <input 
                            class="form-check-input" 
                            type="checkbox" 
                            name="ofertas" 
                            id="ofertas" 
                            {% if app.request.get('ofertas') %}checked{% endif %}>
                        <label class="form-check-label" for="ofertas">
                            Ofertas
                        </label>
                    </div>

                    <!-- Filtro de Precio -->
                    <div class="form-group mt-3">
                        <label for="precio">Precio:</label>
                        <input 
                            type="range" 
                            class="form-control-range" 
                            id="precio" 
                            name="precio" 
                            min="{{ minPrice }}" 
                            max="{{ maxPrice }}" 
                            value="{{ app.request.get('precio') or maxPrice }}">
                        <div class="d-flex justify-content-between mt-2">
                            <span id="precio_min_value">{{ minPrice }}€</span>
                            <span id="precio_max_value">{{ app.request.get('precio') or maxPrice }}€</span>
                        </div>
                    </div>

                    <!-- Filtro de Categoría -->
                    <div class="form-group mt-3">
                        <label for="categoria">Categoría:</label>
                        <select name="categoria" id="categoria" class="form-control">
                            <option value="">Seleccionar categoría</option>
                            {% for categoria in categorias %}
                                <option value="{{ categoria.id }}" {% if categoria.id == app.request.get('categoria') %}selected{% endif %}>
                                    {{ categoria.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Botón de Filtrar -->
                    <button type="submit" class="btn btn-primary w-100 mt-3">Filtrar</button>
                </div>
            </form>
        </div>

        <!-- Carrusel de productos -->
        <div class="col-md-9">
            <h1 class="page-title">Lista de Productos</h1>

            {% for categoria, productos in productosPorCategoria %}
                <h2>{{ categoria }}</h2>
                <div id="carousel{{ categoria }}" class="carousel slide" data-bs-ride="carousel">
                    <div class="carousel-inner">
                        {% set productChunks = productos|batch(5) %}
                        {% for chunk in productChunks %}
                            <div class="carousel-item {% if loop.first %}active{% endif %}">
                                <div class="d-flex justify-content-start">
                                    {% for producto in chunk %}
                                        <div class="text-center mx-2" style="min-width: 150px;">
                                            {% if producto.imagenUrl %}
                                                <img src="{{ asset('uploads/images/' ~ producto.imagenUrl) }}" 
                                                    class="rounded" 
                                                    alt="{{ producto.name }}" 
                                                    style="max-width: 100px; height: auto; object-fit: contain;">
                                            {% else %}
                                                <img src="https://via.placeholder.com/100x100?text=No+Image" 
                                                    class="rounded" 
                                                    alt="Imagen no disponible" 
                                                    style="max-width: 100px; height: auto; object-fit: contain;">
                                            {% endif %}
                                            <h6 class="mt-2">{{ producto.name }}</h6>
                                            <p class="text-success fw-bold">
                                                {{ (producto.price / 100) | number_format(2, '.', '') }} €
                                            </p>
                                            <a href="{{ path('app_producto_detalle', { id: producto.id }) }}" class="btn btn-info mt-2">Ver detalles</a>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>

                    <!-- Controles de navegación (flechas) -->
                    <button class="carousel-control-prev" type="button" data-bs-target="#carousel{{ categoria }}" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true" style="background-color: black;"></span>
                        <span class="visually-hidden">Anterior</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carousel{{ categoria }}" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true" style="background-color: black;"></span>
                        <span class="visually-hidden">Siguiente</span>
                    </button>
                </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script src="{{ asset('assets/js/price-range.js') }}"></script>
{% endblock %}
